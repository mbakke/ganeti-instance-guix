ganeti-instance-guix
====================

Create GuixSD instances on Ganeti!

Usage:

$ gnt-instance add -o guix -O \
  "config=$(base64 /path/to/config.scm),branch=staging" [...]

Installation:

$ ./configure --with-os-dir=/srv/ganeti/os [...]
$ make && make install

Dependencies:

* Working Guix installation.
* User namespaces enabled in kernel.
* git (optional)
* util-linux
* qemu-img

How it works:

Essentially this is a fancy wrapper for "guix system disk-image".  If
the "repo_uri" OS parameter is "host", the disk image will be built using
the local (root) Guix package definitions and copied onto the Ganeti disk
device.

When "repo_uri" is empty or a git URL, Guix will attempt to build itself
from the specified git commit before using that to build the disk image.

Limitations:

* "disk_type" must be 'ide' or similar so /dev/sda is present.
* Runs with elevated privileges on the host.
** ...but drops to unprivileged Guix container.
